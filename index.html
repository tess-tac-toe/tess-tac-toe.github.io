<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <style>
        table.inner {
            border-collapse: collapse;
            border: 2px solid #000;
        }

        td.inner {
            border: 1px solid #000;

            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;

            padding: 3px;
            font-size: 30px;
            cursor: pointer;
            user-select: none;
        }

        td.main {
            padding: 7px;
        }
    </style>
</head>

<body>
    <script>
        // https://tess-tac-toe.github.io/
        // tic-tac-toe on tesseract (4 dimension cube)

        function table({ n, item = (i, j) => "", name = "main", prefix = "m" }) {
            const body = new Array(n).fill().map((_, i) => {
                return "<tr>" + new Array(n).fill().map((_, j) =>
                    `<td class="${name}" id="${prefix}_${i}_${j}">${item(i, j)}</td>`).join("") + "</tr>";
            }).join("");

            return `<table class="${name}"><tbody>${body}</tbody></table>`
        }

        function render(n) {
            document.body.innerHTML = table({ n, item: (i, j) => table({ n, name: "inner", prefix: `i_${i}_${j}` }) });
            let cells = new Array(n ** 4).fill();

            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    for (let k = 0; k < n; k++) {
                        for (let l = 0; l < n; l++) {
                            cells[i + n * (j + n * (k + n * l))] = document.getElementById(`i_${i}_${j}_${k}_${l}`);
                        }
                    }
                }
            }

            return cells;
        }

        function getChecks(n) {
            let options = ["u", "d"].concat(new Array(n).fill().map((_, i) => i)), checks = [];

            for (let o1 of options) {
                for (let o2 of options) {
                    for (let o3 of options) {
                        for (let o4 of options) {
                            let check = []
                            for (let i = 0; i < n; i++) {
                                let [a, b, c, d] = [o1, o2, o3, o4].map(v => {
                                    if (v === "u") { return i; }
                                    if (v === "d") { return n - 1 - i; }
                                    return v;
                                });
                                let posId = a + n * (b + n * (c + n * d));
                                check.push(posId);
                            }
                            if (new Set(check).size === n) { checks.push(check); }
                        }
                    }
                }
            }

            return checks;
        }

        function checkWinner(opt) {
            if (winner) { return; }
            let ids = checks.find(ids => ids.every(id => cells[id].innerText === "X"));
            if (!ids) { return; }

            winner = opt;
            winningCells = ids;
        }

        function play(id, isX) {
            checkWinner('X');
            checkWinner('O');

            if (winner) { return console.error("Game ended"); }
            if (nowX !== isX) { return console.error("Player mismatch"); }
            if (!cells[id]) { return console.error("Bad cell " + id); }

            cells[id].innerText = nowX ? 'X' : 'O';
            nowX = !nowX;
        }

        function aiPlay() {
            const stats = checks.map(ids => ({ ids, count: ids.filter(id => cells[id].innerText === "O").length })),
                max = Math.max(...stats.map(e => e.count)),
                opts = stats.filter(e => e.count === max),
                optIds = opts[Math.floor(Math.random() * opts.length)].ids,
                emptyIds = optIds.filter(id => cells[id].innerText === ""),
                chosenId = emptyIds[Math.floor(Math.random() * emptyIds.length)];

            play(chosenId, false);
        }

        function onClick({ target }) {
            const id = cells.indexOf(target);
            if (id === -1) { return; }

            play(id, true);
            aiPlay();

            if (winner) {
                winningCells.forEach(id => cells[id].style.background = "lightgray");
                document.removeEventListener("click", onClick);
            }
        }

        let n = 4, nowX = true, winner, winningCells, cells = render(n), checks = getChecks(n);

        document.addEventListener("click", onClick);
    </script>
</body>

</html>