<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <style>
        table.inner {
            border-collapse: collapse;
            border: 2px solid #000;
        }

        td.inner {
            border: 1px solid #000;

            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;

            padding: 3px;
            font-size: 30px;
            cursor: pointer;
            user-select: none;
        }

        td.main {
            padding: 7px;
        }
    </style>
</head>

<body>
    <script>
        function table({ n, item = (i, j) => "", name = "main", prefix = "m" }) {
            const body = new Array(n).fill().map((_, i) => {
                return "<tr>" + new Array(n).fill().map((_, j) =>
                    `<td class="${name}" id="${prefix}_${i}_${j}">${item(i, j)}</td>`).join("") + "</tr>";
            }).join("");

            return `<table class="${name}"><tbody>${body}</tbody></table>`
        }

        function render(n) {
            document.body.innerHTML = table({ n, item: (i, j) => table({ n, name: "inner", prefix: `i_${i}_${j}` }) });
            let cells = new Array(n ** 4).fill();

            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    for (let k = 0; k < n; k++) {
                        for (let l = 0; l < n; l++) {
                            cells[i + n * (j + n * (k + n * l))] = document.getElementById(`i_${i}_${j}_${k}_${l}`);
                        }
                    }
                }
            }

            return cells;
        }

        function getChecks(n) {
            let options = ["u", "d"].concat(new Array(n).fill().map((_, i) => i)), checks = [];

            for (let o1 of options) {
                for (let o2 of options) {
                    for (let o3 of options) {
                        for (let o4 of options) {
                            let check = []
                            for (let i = 0; i < n; i++) {
                                let [a, b, c, d] = [o1, o2, o3, o4].map(v => {
                                    if (v === "u") { return i; }
                                    if (v === "d") { return n - 1 - i; }
                                    return v;
                                });
                                let posId = a + n * (b + n * (c + n * d));
                                check.push(posId);
                            }
                            if (new Set(check).size === n) { checks.push(check); }
                        }
                    }
                }
            }

            return checks;
        }

        function checkWinner() {
            let x = checks.find(ids => ids.every(id => cells[id].innerText === "X"));
            if (x) {
                alert("X wins: " + x);
            }

            let o = checks.find(ids => ids.every(id => cells[id].innerText === "O"));
            if (o) {
                alert("O wins: " + o);
            }
        }

        let n = 4, nowX = true, cells = render(n), checks = getChecks(n);

        document.addEventListener("click", ({ target }) => {
            if (target.tagName !== "TD") { return; }
            if (target.innerText !== "") { return; }

            target.innerText = nowX ? 'X' : 'O';
            nowX = !nowX;
            checkWinner();
        });




    </script>
</body>

</html>